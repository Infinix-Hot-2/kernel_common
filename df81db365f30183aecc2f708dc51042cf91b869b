{
  "comments": [
    {
      "key": {
        "uuid": "ee616dea_57da4ea9",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 465,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2015-09-28T21:24:31Z",
      "side": 1,
      "message": "This is usually frowned upon...although I see it scattered all over in /drivers/md\n\nhttps://www.kernel.org/doc/Documentation/CodingStyle\n\nSee below for an alternative.",
      "range": {
        "startLine": 463,
        "startChar": 0,
        "endLine": 465,
        "endChar": 20
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ceae6993_e1cb7c31",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 465,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-09-29T12:50:05Z",
      "side": 1,
      "message": "Good point. The typedef is not really needed anyway.",
      "parentUuid": "ee616dea_57da4ea9",
      "range": {
        "startLine": 463,
        "startChar": 0,
        "endLine": 465,
        "endChar": 20
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ee616dea_976566a9",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2015-09-28T21:24:31Z",
      "side": 1,
      "message": "int (*verity_bv_block_func) (dm_verity *v, struct dm_verity_io *io, u8 *data, size_t len)",
      "range": {
        "startLine": 474,
        "startChar": 9,
        "endLine": 474,
        "endChar": 38
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ec3bd5a_b8bb7545",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-09-29T12:50:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ee616dea_976566a9",
      "range": {
        "startLine": 474,
        "startChar": 9,
        "endLine": 474,
        "endChar": 38
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f8df777d_22bceeea",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 781,
      "author": {
        "id": 1022354
      },
      "writtenOn": "2015-11-05T00:40:07Z",
      "side": 1,
      "message": "why use vzalloc here instead of kzalloc?  Is there a specific fear that kzalloc is going to fail to allocate?",
      "range": {
        "startLine": 781,
        "startChar": 16,
        "endLine": 781,
        "endChar": 23
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b69d1e72_b7fff01b",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 781,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-11-05T01:27:43Z",
      "side": 1,
      "message": "It\u0027s because the buffer can be relatively large, up to 1 MiB using the default error correction parameters. I could try kzalloc and fall back to vzalloc if it fails though.",
      "parentUuid": "f8df777d_22bceeea",
      "range": {
        "startLine": 781,
        "startChar": 16,
        "endLine": 781,
        "endChar": 23
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "568ea242_5de34758",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 781,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2015-11-05T16:06:20Z",
      "side": 1,
      "message": "As this is part of initialization, I would accept the slowness of vzalloc dealing with a large allocation of scattered blocks, rather than have this possibly consume a precious contiguous block of very high ranking away from other systems.",
      "parentUuid": "b69d1e72_b7fff01b",
      "range": {
        "startLine": 781,
        "startChar": 16,
        "endLine": 781,
        "endChar": 23
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b6b19e59_518c7457",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 781,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-11-09T22:02:20Z",
      "side": 1,
      "message": "Upstream had some concerns about this. They recommend against allocating memory during IO, because that might lead to failures in face of low memory.\n\nI explained how preallocating the buffers for each IO operation would be wasteful considering the buffers can be large and they are only needed if there are errors. The recommendation was to punt error correcting work to a worker thread and use a mempool to allocate memory there.\n\nAny thoughts on this? I think the worker thread approach sounds reasonable, but I also don\u0027t think it\u0027s a huge problem if we fail to correct an error when the device is out of memory.",
      "parentUuid": "568ea242_5de34758",
      "range": {
        "startLine": 781,
        "startChar": 16,
        "endLine": 781,
        "endChar": 23
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "16c50ace_a4ec82eb",
        "filename": "drivers/md/dm-verity.c",
        "patchSetId": 2
      },
      "lineNbr": 781,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2015-11-09T22:33:46Z",
      "side": 1,
      "message": "does mempool mean kmem_cache? It seems wasteful to be hording memory on a device that is low on it for functionality that may never be used during the lifetime of the device.",
      "parentUuid": "b6b19e59_518c7457",
      "range": {
        "startLine": 781,
        "startChar": 16,
        "endLine": 781,
        "endChar": 23
      },
      "revId": "df81db365f30183aecc2f708dc51042cf91b869b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}