{
  "comments": [
    {
      "key": {
        "uuid": "a5532654_deb91594",
        "filename": "drivers/md/Makefile",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "What would you say about including this as an optional module in dm-verity, similarly to how dm-verity-fec is implemented?",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 54,
        "endChar": 54
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2a52a3ad_56fbd492",
        "filename": "drivers/md/Makefile",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a5532654_deb91594",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 54,
        "endChar": 54
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4568aa02_5851a10a",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 73,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "Why is this necessary?",
      "range": {
        "startLine": 73,
        "startChar": 10,
        "endLine": 73,
        "endChar": 53
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2a52a3ad_529519f0",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 73,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Yes seems to be an overkill.. Will remove this..",
      "parentUuid": "4568aa02_5851a10a",
      "range": {
        "startLine": 73,
        "startChar": 10,
        "endLine": 73,
        "endChar": 53
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "85a702bf_52c9722c",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 144,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "Instead of freeing the pages you already allocated, it would simplify the  code quite a bit to just jump to free_pages and testing if the page was allocated before freeing it. Something like this, perhaps:\n\n  for (n \u003d 0; n \u003c npages; n++)\n    if (pages[n])\n      __free_page(pages[n]);",
      "range": {
        "startLine": 142,
        "startChar": 3,
        "endLine": 144,
        "endChar": 39
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ea1debf7_8f238581",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 144,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "85a702bf_52c9722c",
      "range": {
        "startLine": 142,
        "startChar": 3,
        "endLine": 144,
        "endChar": 39
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a5532654_beff011a",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "FEC_BLOCK_SIZE is never larger than the verity block size, which is limited to PAGE_SIZE in verity_ctr. If you want, you can just include this in the BUG_ON.",
      "range": {
        "startLine": 189,
        "startChar": 0,
        "endLine": 189,
        "endChar": 32
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4a4357e2_d7c284ab",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 189,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a5532654_beff011a",
      "range": {
        "startLine": 189,
        "startChar": 0,
        "endLine": 189,
        "endChar": 32
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "85b2a2f4_7a14751c",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 201,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "It\u0027s safe to assume that the size of struct fec_header is always at most PAGE_SIZE and just use BUG_ON. This would somewhat simplify the code.",
      "range": {
        "startLine": 201,
        "startChar": 0,
        "endLine": 201,
        "endChar": 43
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a1aaf01_06176428",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 201,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "85b2a2f4_7a14751c",
      "range": {
        "startLine": 201,
        "startChar": 0,
        "endLine": 201,
        "endChar": 43
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "65acceb5_41f21493",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 261,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "In this function it\u0027s safe to assume that you only need to read one page from the beginning of the metadata. This would make the function (and others) quite a bit simpler since you only need to deal with a single page.",
      "range": {
        "startLine": 261,
        "startChar": 0,
        "endLine": 261,
        "endChar": 38
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a1aaf01_31fe6084",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 261,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "I do see that it is really rare for the verity_table to be larger than PAGE_SIZE. But, Is the current code too redundant ?? If yes, I will remove the code that handles the case where the verity_table size exceeds the PAGE_SIZE.",
      "parentUuid": "65acceb5_41f21493",
      "range": {
        "startLine": 261,
        "startChar": 0,
        "endLine": 261,
        "endChar": 38
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6aa2db12_31956a04",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 261,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2016-01-08T14:31:56Z",
      "side": 1,
      "message": "I still think it\u0027s safe to assume that verity metadata block fits into PAGE_SIZE, but if you feel it\u0027s prudent to prepare for the alternative despite the more complicated code path, I\u0027m fine with that.",
      "parentUuid": "8a1aaf01_31fe6084",
      "range": {
        "startLine": 261,
        "startChar": 0,
        "endLine": 261,
        "endChar": 38
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e59a7e77_b548caaf",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 398,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "We want to remove logging mode, so let\u0027s leave this out. Always use either restart or EIO mode.",
      "range": {
        "startLine": 397,
        "startChar": 0,
        "endLine": 398,
        "endChar": 32
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6a481bfe_ad6f6990",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 398,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e59a7e77_b548caaf",
      "range": {
        "startLine": 397,
        "startChar": 0,
        "endLine": 398,
        "endChar": 32
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a5532654_7e7a899d",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 406,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "EINVAL?",
      "range": {
        "startLine": 406,
        "startChar": 15,
        "endLine": 406,
        "endChar": 21
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4a4357e2_1231dade",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 406,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a5532654_7e7a899d",
      "range": {
        "startLine": 406,
        "startChar": 15,
        "endLine": 406,
        "endChar": 21
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "65acceb5_a1aaf893",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 420,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "VERITY_METADATA_VERSION?",
      "range": {
        "startLine": 420,
        "startChar": 46,
        "endLine": 420,
        "endChar": 47
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a1aaf01_d1c6041f",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 420,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "65acceb5_a1aaf893",
      "range": {
        "startLine": 420,
        "startChar": 46,
        "endLine": 420,
        "endChar": 47
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "85b2a2f4_fa3c05bd",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 421,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "Unsupported version?",
      "range": {
        "startLine": 421,
        "startChar": 19,
        "endLine": 421,
        "endChar": 31
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6a481bfe_cdac35c6",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 421,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "85b2a2f4_fa3c05bd",
      "range": {
        "startLine": 421,
        "startChar": 19,
        "endLine": 421,
        "endChar": 31
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "25673634_b7660230",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 452,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "You could have just one error (or out) label if you initialize pks to NULL. It\u0027s safe to call kfree(NULL). The same can be applied elsewhere in this file too to simplify exit paths.",
      "range": {
        "startLine": 452,
        "startChar": 7,
        "endLine": 452,
        "endChar": 19
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aa3e9347_affa05da",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 452,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "25673634_b7660230",
      "range": {
        "startLine": 452,
        "startChar": 7,
        "endLine": 452,
        "endChar": 19
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "25673634_37a67286",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 489,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "In EIO mode, we should not allow mounting the partition if something fails.",
      "range": {
        "startLine": 489,
        "startChar": 0,
        "endLine": 489,
        "endChar": 46
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a41cfd9_74812ee5",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 489,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Should be sufficient enough if I just reword this... init would not see /dev/dm-0 if we failed to mount here and hence it would fail to mount the root partition.",
      "parentUuid": "25673634_37a67286",
      "range": {
        "startLine": 489,
        "startChar": 0,
        "endLine": 489,
        "endChar": 46
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "056cf246_e6b620fc",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 500,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "sector_t for data_sectors and u32 for data_block_size.",
      "range": {
        "startLine": 500,
        "startChar": 1,
        "endLine": 500,
        "endChar": 4
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aa3e9347_8f6dc147",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 500,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "056cf246_e6b620fc",
      "range": {
        "startLine": 500,
        "startChar": 1,
        "endLine": 500,
        "endChar": 4
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "056cf246_83d39e52",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "What\u0027s the purpose of this?",
      "range": {
        "startLine": 503,
        "startChar": 0,
        "endLine": 503,
        "endChar": 15
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a41cfd9_348ba607",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Sorry.. Had this for debugging... Will remove this..",
      "parentUuid": "056cf246_83d39e52",
      "range": {
        "startLine": 503,
        "startChar": 0,
        "endLine": 503,
        "endChar": 15
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e59a7e77_353dba0d",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 529,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "Redundant? Also, consistent error message format would be useful in case we need to parse logs later to collect statistics.",
      "range": {
        "startLine": 529,
        "startChar": 21,
        "endLine": 529,
        "endChar": 39
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4a4357e2_92864a3c",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 529,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e59a7e77_353dba0d",
      "range": {
        "startLine": 529,
        "startChar": 21,
        "endLine": 529,
        "endChar": 39
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e5599e74_3da65b86",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 581,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "This is not really the best way to check for overflow, and note that whether ti-\u003elen is 64 bits depends on CONFIG_LBDAF.\n\nYou should follow dm-verity\u0027s example when verifying these values:\n\nhttps://android.googlesource.com/kernel/common/+/android-3.10/drivers/md/dm-verity-target.c#919\nhttps://android.googlesource.com/kernel/common/+/android-3.10/drivers/md/dm-verity-target.c#939\n\nAs a side note, if you had to test for overflow for arbitrary values, you could simply use something like this:\n\n  static inline bool test_mult_overflow(sector_t a, u32 b)\n  {\n    sector_t r \u003d (sector_t)~0ULL;\n    sector_div(r, b);\n    return a \u003e r:\n  }\n\nBut that\u0027s not needed here.",
      "range": {
        "startLine": 580,
        "startChar": 1,
        "endLine": 581,
        "endChar": 22
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4a4357e2_c66f3390",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 581,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Shouldn\u0027t I be check for overflow and leave the actual validation of the block size and number of sectors to the dm-verity-target code ? If yes, I am planning to use the test_mult_overflow routine that you pointed out and leave the actual data validation to the dm-verity-target code.",
      "parentUuid": "e5599e74_3da65b86",
      "range": {
        "startLine": 580,
        "startChar": 1,
        "endLine": 581,
        "endChar": 22
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0a54ffaf_89c13d0a",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 581,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2016-01-08T14:31:56Z",
      "side": 1,
      "message": "Yes, checking for overflow is sufficient here. Just note that dividing 64-bit numbers should be done with do_div (or sector_div for sector_t).",
      "parentUuid": "4a4357e2_c66f3390",
      "range": {
        "startLine": 580,
        "startChar": 1,
        "endLine": 581,
        "endChar": 22
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a5532654_be28a164",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 582,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "Note that you need to use do_div to divide 64-bit values in kernel. It\u0027s not necessary here though, see the previous comment.",
      "range": {
        "startLine": 582,
        "startChar": 17,
        "endLine": 582,
        "endChar": 61
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ca202730_d3312c96",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 582,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Changed data_block_size to u32.",
      "parentUuid": "a5532654_be28a164",
      "range": {
        "startLine": 582,
        "startChar": 17,
        "endLine": 582,
        "endChar": 61
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6a31fb81_3c171933",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 582,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2016-01-08T14:46:09Z",
      "side": 1,
      "message": "Is this enough? I\u0027m sure the compiler optimizes this into a shift, but what if it doesn\u0027t? data_sectors * data_block_size results in sector_t, which then leads to a 64-bit division. How about being explicit that you want a shift instead?\n\n  data_sectors *\u003d data_block_size \u003c\u003c SECTOR_SHIFT;",
      "parentUuid": "ca202730_d3312c96",
      "range": {
        "startLine": 582,
        "startChar": 17,
        "endLine": 582,
        "endChar": 61
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c55c9a66_dc5121e1",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 598,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "The current dm-verity has different feature arguments.\n\nIn restart mode you should add three arguments (2 restart_on_corruption ignore_zero_blocks) and in EIO mode two (1 ignore_zero_blocks).\n\nIn addition, we need to parse error correction metadata if CONFIG_DM_VERITY_FEC is set and format relevant arguments to dm-verity. See the example here:\nhttps://android.googlesource.com/platform/system/core/+/master/fs_mgr/fs_mgr_verity.cpp#229",
      "range": {
        "startLine": 598,
        "startChar": 1,
        "endLine": 598,
        "endChar": 52
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aa1773d7_82e59b37",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 598,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "When CONFIG_DM_VERITY_FEC is enabled, For parsing the error correction metadata, I am planning to follow *** static int parse_ecc_header(fec_handle *f, uint64_t offset) *** function.\n\nThe following seems to be the arguments that I require.\n1. ecc_dev :\u003d same as the system partition\u0027s block device\n2. ecc.start :\u003d header.inp_size\n3. ecc.blocks :\u003d fec_div_round_up(header.inp_size, FEC_BLOCKSIZE)\n4. ecc.roots :\u003d header.roots\n\nIs this correct ? There seems to be a bunch of data validation in parse_ecc_header function. Should I be doing that as well ?",
      "parentUuid": "c55c9a66_dc5121e1",
      "range": {
        "startLine": 598,
        "startChar": 1,
        "endLine": 598,
        "endChar": 52
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0a54ffaf_a9c6791d",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 598,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2016-01-08T14:31:56Z",
      "side": 1,
      "message": "That looks correct. You should do at least the basic validation to make sure you are looking at an actual FEC header, and note that there\u0027s a back-up header at the other end of the same block in case this one doesn\u0027t look valid. Validating the hash of the actual FEC data is not necessary here though.",
      "parentUuid": "aa1773d7_82e59b37",
      "range": {
        "startLine": 598,
        "startChar": 1,
        "endLine": 598,
        "endChar": 52
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e59a7e77_f552525b",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 621,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "How does this work if dm-verity is compiled as a module? I realize we are not doing that at the moment, but very well might in future.",
      "range": {
        "startLine": 621,
        "startChar": 10,
        "endLine": 621,
        "endChar": 20
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a1aaf01_037751b5",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 621,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Sorry I am not sure whether I understand the problem.. Why do you think that invoking verity_dtr might be problematic if CONFIG_MODULES is enabled ?",
      "parentUuid": "e59a7e77_f552525b",
      "range": {
        "startLine": 621,
        "startChar": 10,
        "endLine": 621,
        "endChar": 20
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ca6e677a_af9bdd59",
        "filename": "drivers/md/dm-android-verity.c",
        "patchSetId": 1
      },
      "lineNbr": 621,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2016-01-08T14:31:56Z",
      "side": 1,
      "message": "Nevermind, you exported all the verity functions. Of course, now that you compile this as part of dm-verity itself, exporting is no longer needed.",
      "parentUuid": "8a1aaf01_037751b5",
      "range": {
        "startLine": 621,
        "startChar": 10,
        "endLine": 621,
        "endChar": 20
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4568aa02_58fc015f",
        "filename": "drivers/md/dm-android-verity.h",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "1 \u003c\u003c SECTOR_SHIFT?",
      "range": {
        "startLine": 9,
        "startChar": 8,
        "endLine": 9,
        "endChar": 19
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ea1debf7_f0a3fdc9",
        "filename": "drivers/md/dm-android-verity.h",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done... Removed SECTOR_SIZE and substituted it with 1 \u003c\u003c SECTOR_SHIFT",
      "parentUuid": "4568aa02_58fc015f",
      "range": {
        "startLine": 9,
        "startChar": 8,
        "endLine": 9,
        "endChar": 19
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "65acceb5_e1a000ba",
        "filename": "drivers/md/dm-android-verity.h",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 1058768
      },
      "writtenOn": "2015-12-15T16:58:32Z",
      "side": 1,
      "message": "\u003cverity_metadata_32K\u003e \u003cfec_data\u003e \u003cfec_metadata_4K\u003e",
      "range": {
        "startLine": 26,
        "startChar": 31,
        "endLine": 26,
        "endChar": 64
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ea1debf7_b086e53b",
        "filename": "drivers/md/dm-android-verity.h",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 1042384
      },
      "writtenOn": "2016-01-08T00:23:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "65acceb5_e1a000ba",
      "range": {
        "startLine": 26,
        "startChar": 31,
        "endLine": 26,
        "endChar": 64
      },
      "revId": "d48d045f53de0e829db062eeeb003a2a2a483166",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}